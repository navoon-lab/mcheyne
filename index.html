<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>맥체인 2독 (Final Icon Fix)</title>
    
    <link rel="icon" type="image/png" href="https://cdnjs.cloudflare.com/ajax/libs/twemoji/14.0.2/72x72/1f4d6.png">
    <link rel="apple-touch-icon" href="https://cdnjs.cloudflare.com/ajax/libs/twemoji/14.0.2/72x72/1f4d6.png">
    
    <style>
        :root {
            /* [색상 팔레트] */
            --primary-color: #1565C0; /* 메인 헤더: 진한 파랑 */
            --bg-color: #F0F4F8;
            --card-bg: #ffffff;
            --text-color: #333;
            --border-color: #E0E0E0;
            
            /* 진행률 바 색상 */
            --month-color: #FFB300; /* 이번 달: 호박색 */
            --year-color: #00E5FF;  /* 올해 전체: 시안색 */
            
            /* 체크 상태 색상: 소프트 틸(청록색) */
            --checked-theme: #26A69A; 
            --checked-bg: #E0F2F1;

            --track-color: rgba(255, 255, 255, 0.25);
        }

        * { box-sizing: border-box; }

        body {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            overflow: hidden; 
        }

        .container {
            width: 100%;
            max-width: 450px;
            height: 100%;
            max-height: 850px;
            background: var(--card-bg);
            display: flex;
            flex-direction: column;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }

        /* 상단 헤더 */
        header {
            background: var(--primary-color);
            color: white;
            padding: 15px 20px 20px 20px;
            text-align: center;
            flex-shrink: 0;
        }

        .goal-badge {
            display: inline-block;
            background: rgba(255,255,255,0.2);
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.8rem;
            margin-bottom: 5px;
            font-weight: 500;
        }

        h1 { margin: 0; font-size: 1.3rem; font-weight: 700; letter-spacing: -0.5px; }
        .current-date { font-size: 0.95rem; opacity: 0.95; margin-top: 2px; }

        /* 진행률 바 */
        .progress-section {
            display: flex;
            gap: 20px;
            margin-top: 15px;
            padding: 0 5px;
        }
        
        .progress-item { flex: 1; text-align: left; }
        .progress-info {
            display: flex; justify-content: space-between; font-size: 0.85rem; margin-bottom: 6px; font-weight: 600;
        }

        .progress-item.month .progress-info { color: var(--month-color); }
        .progress-item.year .progress-info { color: var(--year-color); }
        
        .progress-track {
            background: var(--track-color);
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress-fill { 
            height: 100%; 
            width: 0%; 
            transition: width 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
            box-shadow: 1px 0 3px rgba(0,0,0,0.1);
        }
        
        #monthBar { background: var(--month-color); }
        #yearBar { background: var(--year-color); }

        /* 리스트 영역 (2열 바둑판) */
        .list-container {
            flex-grow: 1;
            padding: 15px;
            display: flex;
            flex-direction: column;
            justify-content: center; 
            background: #fff;
            overflow-y: auto; 
        }

        .chapter-list {
            list-style: none;
            padding: 0;
            margin: 0;
            display: grid;
            grid-template-columns: 1fr 1fr; 
            gap: 10px;
        }

        .chapter-item {
            display: flex;
            align-items: center;
            padding: 12px 10px;
            border: 1px solid var(--border-color);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            background: #fff;
        }

        .chapter-item:active { transform: scale(0.98); background: #f8f9fa; }

        .checkbox {
            width: 22px;
            height: 22px;
            border: 2px solid #ccc;
            border-radius: 50%;
            margin-right: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            flex-shrink: 0;
        }

        .chapter-text {
            font-size: 0.95rem;
            font-weight: 600;
            color: #444;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* 체크 상태 */
        .chapter-item.checked {
            background-color: var(--checked-bg);
            border-color: var(--checked-theme);
            box-shadow: inset 0 0 0 1px var(--checked-theme);
        }
        .chapter-item.checked .checkbox {
            background: var(--checked-theme);
            border-color: var(--checked-theme);
        }
        .chapter-item.checked .checkbox::after {
            content: '✔'; color: white; font-size: 13px;
        }
        .chapter-item.checked .chapter-text {
            color: var(--checked-theme);
            text-decoration: line-through;
            opacity: 0.8;
        }

        /* 달력 */
        .calendar-section {
            padding: 10px 15px;
            border-top: 1px solid #eee;
            background: #fafafa;
            flex-shrink: 0;
        }

        .cal-nav {
            display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;
        }
        .cal-btn { background: none; border: none; font-size: 1.1rem; cursor: pointer; padding: 0 10px; color: #666;}
        .cal-title { font-weight: bold; font-size: 1rem; color: #333; }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
            text-align: center;
        }
        
        .cal-day-header { font-size: 0.75rem; color: #888; margin-bottom: 4px; font-weight: 600;}
        
        .cal-day {
            aspect-ratio: 1.3/1; 
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s;
            color: #444;
        }
        
        .cal-day:hover { background: #e0e0e0; }
        .cal-day.today { border: 2px solid var(--primary-color); color: var(--primary-color); font-weight: 800; }
        .cal-day.selected { background: var(--primary-color); color: white; font-weight: bold; border: none; }

        @media (max-height: 750px) {
            header { padding: 10px 15px; }
            h1 { font-size: 1.1rem; }
            .chapter-item { padding: 8px 6px; }
            .chapter-text { font-size: 0.85rem; }
        }
    </style>
</head>
<body>

<div class="container">
    <header>
        <div class="goal-badge">1년 2독 (매일 8장)</div>
        <h1 id="headerDate"></h1>
        
        <div class="progress-section">
            <div class="progress-item month">
                <div class="progress-info"><span>이번 달</span> <span id="monthPercent">0.0%</span></div>
                <div class="progress-track"><div class="progress-fill" id="monthBar"></div></div>
            </div>
            <div class="progress-item year">
                <div class="progress-info"><span>올해 전체</span> <span id="yearPercent">0.0%</span></div>
                <div class="progress-track"><div class="progress-fill" id="yearBar"></div></div>
            </div>
        </div>
    </header>

    <div class="list-container">
        <ul class="chapter-list" id="chapterList"></ul>
    </div>

    <div class="calendar-section">
        <div class="cal-nav">
            <button class="cal-btn" onclick="changeMonth(-1)">&#10094;</button>
            <span class="cal-title" id="calTitle"></span>
            <button class="cal-btn" onclick="changeMonth(1)">&#10095;</button>
        </div>
        <div class="calendar-grid" id="calendarGrid"></div>
    </div>
</div>

<script>
    // 전체 맥체인 데이터
    const COMPRESSED_DATA = "Gn 1,Ezr 1,Mt 1,Ac 1|Gn 2,Ezr 2,Mt 2,Ac 2|Gn 3,Ezr 3,Mt 3,Ac 3|Gn 4,Ezr 4,Mt 4,Ac 4|Gn 5,Ezr 5,Mt 5,Ac 5|Gn 6,Ezr 6,Mt 6,Ac 6|Gn 7,Ezr 7,Mt 7,Ac 7|Gn 8,Ezr 8,Mt 8,Ac 8|Gn 9-10,Ezr 9,Mt 9,Ac 9|Gn 11,Ezr 10,Mt 10,Ac 10|Gn 12,Neh 1,Mt 11,Ac 11|Gn 13,Neh 2,Mt 12,Ac 12|Gn 14,Neh 3,Mt 13,Ac 13|Gn 15,Neh 4,Mt 14,Ac 14|Gn 16,Neh 5,Mt 15,Ac 15|Gn 17,Neh 6,Mt 16,Ac 16|Gn 18,Neh 7,Mt 17,Ac 17|Gn 19,Neh 8,Mt 18,Ac 18|Gn 20,Neh 9,Mt 19,Ac 19|Gn 21,Neh 10,Mt 20,Ac 20|Gn 22,Neh 11,Mt 21,Ac 21|Gn 23,Neh 12,Mt 22,Ac 22|Gn 24,Neh 13,Mt 23,Ac 23|Gn 25,Est 1,Mt 24,Ac 24|Gn 26,Est 2,Mt 25,Ac 25|Gn 27,Est 3,Mt 26,Ac 26|Gn 28,Est 4,Mt 27,Ac 27|Gn 29,Est 5,Mt 28,Ac 28|Gn 30,Est 6,Mk 1,Rm 1|Gn 31,Est 7,Mk 2,Rm 2|Gn 32,Est 8,Mk 3,Rm 3|Gn 33,Est 9-10,Mk 4,Rm 4|Gn 34,Jb 1,Mk 5,Rm 5|Gn 35-36,Jb 2,Mk 6,Rm 6|Gn 37,Jb 3,Mk 7,Rm 7|Gn 38,Jb 4,Mk 8,Rm 8|Gn 39,Jb 5,Mk 9,Rm 9|Gn 40,Jb 6,Mk 10,Rm 10|Gn 41,Jb 7,Mk 11,Rm 11|Gn 42,Jb 8,Mk 12,Rm 12|Gn 43,Jb 9,Mk 13,Rm 13|Gn 44,Jb 10,Mk 14,Rm 14|Gn 45,Jb 11,Mk 15,Rm 15|Gn 46,Jb 12,Mk 16,Rm 16|Gn 47,Jb 13,Lk 1:1-38,1Co 1|Gn 48,Jb 14,Lk 1:39-80,1Co 2|Gn 49,Jb 15,Lk 2,1Co 3|Gn 50,Jb 16-17,Lk 3,1Co 4|Ex 1,Jb 18,Lk 4,1Co 5|Ex 2,Jb 19,Lk 5,1Co 6|Ex 3,Jb 20,Lk 6,1Co 7|Ex 4,Jb 21,Lk 7,1Co 8|Ex 5,Jb 22,Lk 8,1Co 9|Ex 6,Jb 23,Lk 9,1Co 10|Ex 7,Jb 24,Lk 10,1Co 11|Ex 8,Jb 25-26,Lk 11,1Co 12|Ex 9,Jb 27,Lk 12,1Co 13|Ex 10,Jb 28,Lk 13,1Co 14|Ex 11:1-12:20,Jb 29,Lk 14,1Co 15|Ex 12:21-51,Jb 30,Lk 15,1Co 16|Ex 13,Jb 31,Lk 16,2Co 1|Ex 14,Jb 32,Lk 17,2Co 2|Ex 15,Jb 33,Lk 18,2Co 3|Ex 16,Jb 34,Lk 19,2Co 4|Ex 17,Jb 35,Lk 20,2Co 5|Ex 18,Jb 36,Lk 21,2Co 6|Ex 19,Jb 37,Lk 22,2Co 7|Ex 20,Jb 38,Lk 23,2Co 8|Ex 21,Jb 39,Lk 24,2Co 9|Ex 22,Jb 40,Jn 1,2Co 10|Ex 23,Jb 41,Jn 2,2Co 11|Ex 24,Jb 42,Jn 3,2Co 12|Ex 25,Pr 1,Jn 4,2Co 13|Ex 26,Pr 2,Jn 5,Ga 1|Ex 27,Pr 3,Jn 6,Ga 2|Ex 28,Pr 4,Jn 7,Ga 3|Ex 29,Pr 5,Jn 8,Ga 4|Ex 30,Pr 6,Jn 9,Ga 5|Ex 31,Pr 7,Jn 10,Ga 6|Ex 32,Pr 8,Jn 11,Ep 1|Ex 33,Pr 9,Jn 12,Ep 2|Ex 34,Pr 10,Jn 13,Ep 3|Ex 35,Pr 11,Jn 14,Ep 4|Ex 36,Pr 12,Jn 15,Ep 5|Ex 37,Pr 13,Jn 16,Ep 6|Ex 38,Pr 14,Jn 17,Ph 1|Ex 39,Pr 15,Jn 18,Ph 2|Ex 40,Pr 16,Jn 19,Ph 3|Lv 1,Pr 17,Jn 20,Ph 4|Lv 2-3,Pr 18,Jn 21,Cl 1|Lv 4,Pr 19,Ps 1-2,Cl 2|Lv 5,Pr 20,Ps 3-4,Cl 3|Lv 6,Pr 21,Ps 5-6,Cl 4|Lv 7,Pr 22,Ps 7-8,1Th 1|Lv 8,Pr 23,Ps 9,1Th 2|Lv 9,Pr 24,Ps 10,1Th 3|Lv 10,Pr 25,Ps 11-12,1Th 4|Lv 11-12,Pr 26,Ps 13-14,1Th 5|Lv 13,Pr 27,Ps 15-16,2Th 1|Lv 14,Pr 28,Ps 17,2Th 2|Lv 15,Pr 29,Ps 18,2Th 3|Lv 16,Pr 30,Ps 19,1Ti 1|Lv 17,Pr 31,Ps 20-21,1Ti 2|Lv 18,Ec 1,Ps 22,1Ti 3|Lv 19,Ec 2,Ps 23-24,1Ti 4|Lv 20,Ec 3,Ps 25,1Ti 5|Lv 21,Ec 4,Ps 26-27,1Ti 6|Lv 22,Ec 5,Ps 28-29,2Ti 1|Lv 23,Ec 6,Ps 30,2Ti 2|Lv 24,Ec 7,Ps 31,2Ti 3|Lv 25,Ec 8,Ps 32,2Ti 4|Lv 26,Ec 9,Ps 33,Tit 1|Lv 27,Ec 10,Ps 34,Tit 2|Nu 1,Ec 11,Ps 35,Tit 3|Nu 2,Ec 12,Ps 36,Phm 1|Nu 3,So 1,Ps 37,Heb 1|Nu 4,So 2,Ps 38,Heb 2|Nu 5,So 3,Ps 39,Heb 3|Nu 6,So 4,Ps 40-41,Heb 4|Nu 7,So 5,Ps 42-43,Heb 5|Nu 8,So 6,Ps 44,Heb 6|Nu 9,So 7,Ps 45,Heb 7|Nu 10,So 8,Ps 46-47,Heb 8|Nu 11,Is 1,Ps 48,Heb 9|Nu 12-13,Is 2,Ps 49,Heb 10|Nu 14,Is 3-4,Ps 50,Heb 11|Nu 15,Is 5,Ps 51,Heb 12|Nu 16,Is 6,Ps 52-54,Heb 13|Nu 17-18,Is 7,Ps 55,Ja 1|Nu 19,Is 8:1-9:7,Ps 56-57,Ja 2|Nu 20,Is 9:8-10:4,Ps 58-59,Ja 3|Nu 21,Is 10:5-34,Ps 60-61,Ja 4|Nu 22,Is 11-12,Ps 62-63,Ja 5|Nu 23,Is 13,Ps 64-65,1Pe 1|Nu 24,Is 14,Ps 66-67,1Pe 2|Nu 25,Is 15,Ps 68,1Pe 3|Nu 26,Is 16,Ps 69,1Pe 4|Nu 27,Is 17-18,Ps 70-71,1Pe 5|Nu 28,Is 19-20,Ps 72,2Pe 1|Nu 29,Is 21,Ps 73,2Pe 2|Nu 30,Is 22,Ps 74,2Pe 3|Nu 31,Is 23,Ps 75-76,1Jn 1|Nu 32,Is 24,Ps 77,1Jn 2|Nu 33,Is 25,Ps 78:1-39,1Jn 3|Nu 34,Is 26,Ps 78:40-72,1Jn 4|Nu 35,Is 27,Ps 79,1Jn 5|Nu 36,Is 28,Ps 80,2Jn 1|Dt 1,Is 29,Ps 81-82,3Jn 1|Dt 2,Is 30,Ps 83-84,Ju 1|Dt 3,Is 31,Ps 85,Re 1|Dt 4,Is 32,Ps 86-87,Re 2|Dt 5,Is 33,Ps 88,Re 3|Dt 6,Is 34,Ps 89,Re 4|Dt 7,Is 35,Ps 90,Re 5|Dt 8,Is 36,Ps 91,Re 6|Dt 9,Is 37,Ps 92-93,Re 7|Dt 10,Is 38,Ps 94,Re 8|Dt 11,Is 39,Ps 95-96,Re 9|Dt 12,Is 40,Ps 97-98,Re 10|Dt 13-14,Is 41,Ps 99-101,Re 11|Dt 15,Is 42,Ps 102,Re 12|Dt 16,Is 43,Ps 103,Re 13|Dt 17,Is 44,Ps 104,Re 14|Dt 18,Is 45,Ps 105,Re 15|Dt 19,Is 46,Ps 106,Re 16|Dt 20,Is 47,Ps 107,Re 17|Dt 21,Is 48,Ps 108-109,Re 18|Dt 22,Is 49,Ps 110-111,Re 19|Dt 23,Is 50,Ps 112-113,Re 20|Dt 24,Is 51,Ps 114-115,Re 21|Dt 25,Is 52,Ps 116,Re 22|Dt 26,Is 53,Ps 117-118,Mt 1|Dt 27:1-28:19,Is 54,Ps 119:1-24,Mt 2|Dt 28:20-68,Is 55,Ps 119:25-48,Mt 3|Dt 29,Is 56,Ps 119:49-72,Mt 4|Dt 30,Is 57,Ps 119:73-96,Mt 5|Dt 31,Is 58,Ps 119:97-120,Mt 6|Dt 32,Is 59,Ps 119:121-144,Mt 7|Dt 33-34,Is 60,Ps 119:145-176,Mt 8|Jos 1,Is 61,Ps 120-122,Mt 9|Jos 2,Is 62,Ps 123-125,Mt 10|Jos 3,Is 63,Ps 126-128,Mt 11|Jos 4,Is 64,Ps 129-131,Mt 12|Jos 5:1-6:5,Is 65,Ps 132-134,Mt 13|Jos 6:6-27,Is 66,Ps 135-136,Mt 14|Jos 7,Je 1,Ps 137-138,Mt 15|Jos 8,Je 2,Ps 139,Mt 16|Jos 9,Je 3,Ps 140-141,Mt 17|Jos 10,Je 4,Ps 142-143,Mt 18|Jos 11,Je 5,Ps 144-145,Mt 19|Jos 12-13,Je 6,Ps 146-147,Mt 20|Jos 14-15,Je 7,Ps 148-150,Mt 21|Jos 16-17,Je 8,Ac 1,Mt 22|Jos 18-19,Je 9,Ac 2,Mt 23|Jos 20-21,Je 10,Ac 3,Mt 24|Jos 22,Je 11,Ac 4,Mt 25|Jos 23,Je 12,Ac 5,Mt 26|Jos 24,Je 13,Ac 6,Mt 27|Jdg 1,Je 14,Ac 7,Mt 28|Jdg 2,Je 15,Ac 8,Mk 1|Jdg 3,Je 16,Ac 9,Mk 2|Jdg 4,Je 17,Ac 10,Mk 3|Jdg 5,Je 18,Ac 11,Mk 4|Jdg 6,Je 19,Ac 12,Mk 5|Jdg 7,Je 20,Ac 13,Mk 6|Jdg 8,Je 21,Ac 14,Mk 7|Jdg 9,Je 22,Ac 15,Mk 8|Jdg 10,Je 23,Ac 16,Mk 9|Jdg 11,Je 24,Ac 17,Mk 10|Jdg 12,Je 25,Ac 18,Mk 11|Jdg 13,Je 26,Ac 19,Mk 12|Jdg 14,Je 27,Ac 20,Mk 13|Jdg 15,Je 28,Ac 21,Mk 14|Jdg 16,Je 29,Ac 22,Mk 15|Jdg 17,Je 30-31,Ac 23,Mk 16|Jdg 18,Je 32,Ac 24,Ps 1-2|Jdg 19,Je 33,Ac 25,Ps 3-4|Jdg 20,Je 34,Ac 26,Ps 5-6|Jdg 21,Je 35,Ac 27,Ps 7-8|Ru 1,Je 36,Ac 28,Ps 9|Ru 2,Je 37,Rm 1,Ps 10|Ru 3-4,Je 38,Rm 2,Ps 11-12|1Sa 1,Je 39,Rm 3,Ps 13-14|1Sa 2,Je 40,Rm 4,Ps 15-16|1Sa 3,Je 41,Rm 5,Ps 17|1Sa 4,Je 42,Rm 6,Ps 18|1Sa 5-6,Je 43,Rm 7,Ps 19|1Sa 7-8,Je 44,Rm 8,Ps 20-21|1Sa 9,Je 45-46,Rm 9,Ps 22|1Sa 10,Je 47,Rm 10,Ps 23-24|1Sa 11,Je 48,Rm 11,Ps 25|1Sa 12,Je 49,Rm 12,Ps 26-27|1Sa 13,Je 50,Rm 13,Ps 28-29|1Sa 14,Je 51,Rm 14,Ps 30|1Sa 15,Je 52,Rm 15,Ps 31|1Sa 16,La 1,Rm 16,Ps 32|1Sa 17,La 2,1Co 1,Ps 33|1Sa 18,La 3,1Co 2,Ps 34|1Sa 19,La 4,1Co 3,Ps 35|1Sa 20,La 5,1Co 4,Ps 36|1Sa 21-22,Ez 1,1Co 5,Ps 37|1Sa 23,Ez 2,1Co 6,Ps 38|1Sa 24,Ez 3,1Co 7,Ps 39|1Sa 25,Ez 4,1Co 8,Ps 40-41|1Sa 26,Ez 5,1Co 9,Ps 42-43|1Sa 27,Ez 6,1Co 10,Ps 44|1Sa 28,Ez 7,1Co 11,Ps 45|1Sa 29-30,Ez 8,1Co 12,Ps 46-47|1Sa 31,Ez 9,1Co 13,Ps 48|2Sa 1,Ez 10,1Co 14,Ps 49|2Sa 2,Ez 11,1Co 15,Ps 50|2Sa 3,Ez 12,1Co 16,Ps 51|2Sa 4-5,Ez 13,2Co 1,Ps 52-54|2Sa 6,Ez 14,2Co 2,Ps 55|2Sa 7,Ez 15,2Co 3,Ps 56-57|2Sa 8-9,Ez 16,2Co 4,Ps 58-59|2Sa 10,Ez 17,2Co 5,Ps 60-61|2Sa 11,Ez 18,2Co 6,Ps 62-63|2Sa 12,Ez 19,2Co 7,Ps 64-65|2Sa 13,Ez 20,2Co 8,Ps 66-67|2Sa 14,Ez 21,2Co 9,Ps 68|2Sa 15,Ez 22,2Co 10,Ps 69|2Sa 16,Ez 23,2Co 11,Ps 70-71|2Sa 17,Ez 24,2Co 12,Ps 72|2Sa 18,Ez 25,2Co 13,Ps 73|2Sa 19,Ez 26,Ga 1,Ps 74|2Sa 20,Ez 27,Ga 2,Ps 75-76|2Sa 21,Ez 28,Ga 3,Ps 77|2Sa 22,Ez 29,Ga 4,Ps 78:1-39|2Sa 23,Ez 30,Ga 5,Ps 78:40-72|2Sa 24,Ez 31,Ga 6,Ps 79|1Ki 1,Ez 32,Ep 1,Ps 80|1Ki 2,Ez 33,Ep 2,Ps 81-82|1Ki 3,Ez 34,Ep 3,Ps 83-84|1Ki 4-5,Ez 35,Ep 4,Ps 85|1Ki 6,Ez 36,Ep 5,Ps 86-87|1Ki 7,Ez 37,Ep 6,Ps 88|1Ki 8,Ez 38,Ph 1,Ps 89|1Ki 9,Ez 39,Ph 2,Ps 90|1Ki 10,Ez 40,Ph 3,Ps 91|1Ki 11,Ez 41,Ph 4,Ps 92-93|1Ki 12,Ez 42,Cl 1,Ps 94|1Ki 13,Ez 43,Cl 2,Ps 95-96|1Ki 14,Ez 44,Cl 3,Ps 97-98|1Ki 15,Ez 45,Cl 4,Ps 99-101|1Ki 16,Ez 46,1Th 1,Ps 102|1Ki 17,Ez 47,1Th 2,Ps 103|1Ki 18,Ez 48,1Th 3,Ps 104|1Ki 19,Da 1,1Th 4,Ps 105|1Ki 20,Da 2,1Th 5,Ps 106|1Ki 21,Da 3,2Th 1,Ps 107|1Ki 22,Da 4,2Th 2,Ps 108-109|2Ki 1,Da 5,2Th 3,Ps 110-111|2Ki 2,Da 6,1Ti 1,Ps 112-113|2Ki 3,Da 7,1Ti 2,Ps 114-115|2Ki 4,Da 8,1Ti 3,Ps 116|2Ki 5,Da 9,1Ti 4,Ps 117-118|2Ki 6,Da 10,1Ti 5,Ps 119:1-24|2Ki 7,Da 11,1Ti 6,Ps 119:25-48|2Ki 8,Da 12,2Ti 1,Ps 119:49-72|2Ki 9,Ho 1,2Ti 2,Ps 119:73-96|2Ki 10,Ho 2,2Ti 3,Ps 119:97-120|2Ki 11-12,Ho 3-4,2Ti 4,Ps 119:121-144|2Ki 13,Ho 5-6,Tit 1,Ps 119:145-176|2Ki 14,Ho 7,Tit 2,Ps 120-122|2Ki 15,Ho 8,Tit 3,Ps 123-125|2Ki 16,Ho 9,Phm 1,Ps 126-128|2Ki 17,Ho 10,Heb 1,Ps 131|2Ki 18,Ho 11,Heb 2,Ps 132-134|2Ki 19,Ho 12,Heb 3,Ps 135-136|2Ki 20,Ho 13,Heb 4,Ps 137-138|2Ki 21,Ho 14,Heb 5,Ps 139|2Ki 22,Jl 1,Heb 6,Ps 140-141|2Ki 23,Jl 2,Heb 7,Ps 142-143|2Ki 24,Jl 3,Heb 8,Ps 144-145|2Ki 25,Am 1,Heb 9,Ps 146-147|1Ch 1-2,Am 2,Heb 10,Ps 148-150|1Ch 3-4,Am 3,Heb 11,Lk 1:1-38|1Ch 5-6,Am 4,Heb 12,Lk 1:39-80|1Ch 7-8,Am 5,Heb 13,Lk 2|1Ch 9-10,Am 6,Ja 1,Lk 3|1Ch 11-12,Am 7,Ja 2,Lk 4|1Ch 13-14,Am 8,Ja 3,Lk 5|1Ch 15,Am 9,Ja 4,Lk 6|1Ch 16,Ob 1,Ja 5,Lk 7|1Ch 17,Jon 1,1Pe 1,Lk 8|1Ch 18,Jon 2,1Pe 2,Lk 9|1Ch 19-20,Jon 3,1Pe 3,Lk 10|1Ch 21,Jon 4,1Pe 4,Lk 11|1Ch 22,Mi 1,1Pe 5,Lk 12|1Ch 23,Mi 2,2Pe 1,Lk 13|1Ch 24-25,Mi 3,2Pe 2,Lk 14|1Ch 26-27,Mi 4,2Pe 3,Lk 15|1Ch 28,Mi 5,1Jn 1,Lk 16|1Ch 29,Mi 6,1Jn 2,Lk 17|2Ch 1,Mi 7,1Jn 3,Lk 18|2Ch 2,Na 1,1Jn 4,Lk 19|2Ch 3-4,Na 2,1Jn 5,Lk 20|2Ch 5,Na 3,2Jn 1,Lk 21|2Ch 6,Hab 1,3Jn 1,Lk 22|2Ch 7,Hab 2,Ju 1,Lk 23|2Ch 8,Hab 3,Re 1,Lk 24|2Ch 9,Zep 1,Re 2,Jn 1|2Ch 10,Zep 2,Re 3,Jn 2|2Ch 11-12,Zep 3,Re 4,Jn 3|2Ch 13,Hg 1,Re 5,Jn 4|2Ch 14-15,Hg 2,Re 6,Jn 5|2Ch 16,Zec 1,Re 7,Jn 6|2Ch 17,Zec 2,Re 8,Jn 7|2Ch 18,Zec 3,Re 9,Jn 8|2Ch 19-20,Zec 4,Re 10,Jn 9|2Ch 21,Zec 5,Re 11,Jn 10|2Ch 22-23,Zec 6,Re 12,Jn 11|2Ch 24,Zec 7,Re 13,Jn 12|2Ch 25,Zec 8,Re 14,Jn 13|2Ch 26,Zec 9,Re 15,Jn 14|2Ch 27-28,Zec 10,Re 16,Jn 15|2Ch 29,Zec 11,Re 17,Jn 16|2Ch 30,Zec 12,Re 18,Jn 17|2Ch 31,Zec 13,Re 19,Jn 18|2Ch 32,Zec 14,Re 20,Jn 19|2Ch 33,Mal 1,Re 21,Jn 20|2Ch 34,Mal 2,Re 22,Jn 21|2Ch 35,Mal 3,Mt 1,Ps 1-2|2Ch 36,Mal 4,Mt 2,Ps 3-4";

    const bookMap = {
        'Gn': '창세기', 'Ex': '출애굽기', 'Lv': '레위기', 'Nu': '민수기', 'Dt': '신명기',
        'Jos': '여호수아', 'Jdg': '사사기', 'Ru': '룻기', '1Sa': '사무엘상', '2Sa': '사무엘하',
        '1Ki': '열왕기상', '2Ki': '열왕기하', '1Ch': '역대상', '2Ch': '역대하', 'Ezr': '에스라',
        'Neh': '느헤미야', 'Est': '에스더', 'Jb': '욥기', 'Ps': '시편', 'Pr': '잠언',
        'Ec': '전도서', 'So': '아가', 'Is': '이사야', 'Je': '예레미야', 'La': '예레미야애가',
        'Ez': '에스겔', 'Da': '다니엘', 'Ho': '호세아', 'Jl': '요엘', 'Am': '아모스',
        'Ob': '오바댜', 'Jon': '요나', 'Mi': '미가', 'Na': '나훔', 'Hab': '하박국',
        'Zep': '스바냐', 'Hg': '학개', 'Zec': '스가랴', 'Mal': '말라기',
        'Mt': '마태복음', 'Mk': '마가복음', 'Lk': '누가복음', 'Jn': '요한복음', 'Ac': '사도행전',
        'Rm': '로마서', '1Co': '고린도전서', '2Co': '고린도후서', 'Ga': '갈라디아서', 'Ep': '에베소서',
        'Ph': '빌립보서', 'Cl': '골로새서', '1Th': '데살로니가전서', '2Th': '데살로니가후서',
        '1Ti': '디모데전서', '2Ti': '디모데후서', 'Tit': '디도서', 'Phm': '빌레몬서',
        'Heb': '히브리서', 'Ja': '야고보서', '1Pe': '베드로전서', '2Pe': '베드로후서',
        '1Jn': '요한1서', '2Jn': '요한2서', '3Jn': '요한3서', 'Ju': '유다서', 'Re': '요한계시록'
    };

    const bibleOrder = [
        'Gn', 'Ex', 'Lv', 'Nu', 'Dt', 'Jos', 'Jdg', 'Ru', '1Sa', '2Sa', '1Ki', '2Ki', '1Ch', '2Ch', 'Ezr', 'Neh', 'Est',
        'Jb', 'Ps', 'Pr', 'Ec', 'So', 'Is', 'Je', 'La', 'Ez', 'Da', 'Ho', 'Jl', 'Am', 'Ob', 'Jon', 'Mi', 'Na', 'Hab', 'Zep', 'Hg', 'Zec', 'Mal',
        'Mt', 'Mk', 'Lk', 'Jn', 'Ac', 'Rm', '1Co', '2Co', 'Ga', 'Ep', 'Ph', 'Cl', '1Th', '2Th', '1Ti', '2Ti', 'Tit', 'Phm',
        'Heb', 'Ja', '1Pe', '2Pe', '1Jn', '2Jn', '3Jn', 'Ju', 'Re'
    ];
    const bibleOrderMap = {};
    bibleOrder.forEach((bk, i) => bibleOrderMap[bk] = i);

    let selectedDate = new Date();
    let calDate = new Date();
    const mcheyneData = COMPRESSED_DATA.split('|').map(day => day.split(','));

    function init() {
        renderCalendar();
        renderList();
        updateProgress();
    }

    function formatDateKey(date) {
        const offset = date.getTimezoneOffset() * 60000;
        return (new Date(date - offset)).toISOString().slice(0, 10);
    }

    function getDayOfYear(date) {
        const start = new Date(date.getFullYear(), 0, 0);
        const diff = date - start;
        const oneDay = 1000 * 60 * 60 * 24;
        return Math.floor(diff / oneDay);
    }

    function translateBook(text) {
        const parts = text.trim().split(' ');
        if (parts.length < 2) return text;
        const abbr = parts[0];
        const rest = parts.slice(1).join(' ');
        return (bookMap[abbr] || abbr) + ' ' + rest + '장';
    }

    function sortChapters(chapters) {
        return chapters.sort((a, b) => {
            const partsA = a.trim().split(' ');
            const partsB = b.trim().split(' ');
            const bookA = partsA[0];
            const bookB = partsB[0];
            const orderA = bibleOrderMap[bookA] !== undefined ? bibleOrderMap[bookA] : 999;
            const orderB = bibleOrderMap[bookB] !== undefined ? bibleOrderMap[bookB] : 999;
            if (orderA !== orderB) return orderA - orderB;
            return parseInt(partsA[1]) - parseInt(partsB[1]);
        });
    }

    function renderList() {
        const listEl = document.getElementById('chapterList');
        const headerDate = document.getElementById('headerDate');
        const options = { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' };
        headerDate.textContent = selectedDate.toLocaleDateString('ko-KR', options);

        const dayOfYear = getDayOfYear(selectedDate);
        let idx1 = ((dayOfYear - 1) * 2) % 365;
        let idx2 = ((dayOfYear - 1) * 2 + 1) % 365;

        let combinedChapters = sortChapters([...mcheyneData[idx1], ...mcheyneData[idx2]]);
        
        listEl.innerHTML = '';
        const savedProgress = JSON.parse(localStorage.getItem('mcheyne_progress_v3') || '{}');
        const dateKey = formatDateKey(selectedDate);

        combinedChapters.forEach((rawText, index) => {
            const id = `${dateKey}_${rawText.replace(/\s/g, '')}`;
            const isChecked = savedProgress[id];
            const li = document.createElement('li');
            li.className = `chapter-item ${isChecked ? 'checked' : ''}`;
            li.onclick = () => toggleCheck(id);
            li.innerHTML = `<div class="checkbox"></div><span class="chapter-text">${translateBook(rawText)}</span>`;
            listEl.appendChild(li);
        });
    }

    function toggleCheck(id) {
        const progress = JSON.parse(localStorage.getItem('mcheyne_progress_v3') || '{}');
        progress[id] = !progress[id];
        localStorage.setItem('mcheyne_progress_v3', JSON.stringify(progress));
        renderList(); 
        updateProgress(); 
    }

    function updateProgress() {
        const progress = JSON.parse(localStorage.getItem('mcheyne_progress_v3') || '{}');
        const year = selectedDate.getFullYear();
        const month = selectedDate.getMonth();
        let checkedYear = 0, checkedMonth = 0;

        for (const [key, val] of Object.entries(progress)) {
            if (val && key.includes('_')) {
                const d = new Date(key.split('_')[0]);
                if (!isNaN(d.getTime()) && d.getFullYear() === year) {
                    checkedYear++;
                    if (d.getMonth() === month) checkedMonth++;
                }
            }
        }

        const pctYear = Math.min(100, (checkedYear / (365 * 8)) * 100).toFixed(1);
        const daysInMonth = new Date(year, month + 1, 0).getDate();
        const pctMonth = Math.min(100, (checkedMonth / (daysInMonth * 8)) * 100).toFixed(1);

        document.getElementById('monthPercent').textContent = pctMonth + '%';
        document.getElementById('monthBar').style.width = pctMonth + '%';
        document.getElementById('yearPercent').textContent = pctYear + '%';
        document.getElementById('yearBar').style.width = pctYear + '%';
    }

    function renderCalendar() {
        const grid = document.getElementById('calendarGrid');
        const title = document.getElementById('calTitle');
        const year = calDate.getFullYear();
        const month = calDate.getMonth();
        title.textContent = `${year}년 ${month + 1}월`;
        grid.innerHTML = '';

        ['일','월','화','수','목','금','토'].forEach(d => {
            const el = document.createElement('div');
            el.className = 'cal-day-header';
            el.textContent = d;
            grid.appendChild(el);
        });

        const firstDay = new Date(year, month, 1).getDay();
        const lastDate = new Date(year, month + 1, 0).getDate();

        for(let i=0; i<firstDay; i++) {
            grid.appendChild(document.createElement('div')).className = 'cal-day empty';
        }

        const todayKey = formatDateKey(new Date());
        const selectedKey = formatDateKey(selectedDate);

        for(let i=1; i<=lastDate; i++) {
            const d = new Date(year, month, i);
            const dKey = formatDateKey(d);
            const el = document.createElement('div');
            el.className = 'cal-day';
            el.textContent = i;
            if (dKey === todayKey) el.classList.add('today');
            if (dKey === selectedKey) el.classList.add('selected');
            el.onclick = () => { selectedDate = d; renderCalendar(); renderList(); };
            grid.appendChild(el);
        }
    }

    function changeMonth(delta) { calDate.setMonth(calDate.getMonth() + delta); renderCalendar(); }
    init();
</script>
</body>
</html>