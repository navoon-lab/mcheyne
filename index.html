<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>맥체인 성경읽기</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="manifest" href="manifest.json">

<style>
body {
  margin: 0;
  background: #f2f2f2;
  font-family: -apple-system, BlinkMacSystemFont, "Noto Sans KR", sans-serif;
}
.app {
  max-width: 420px;
  margin: auto;
  padding: 16px;
}
.card {
  background: #fff;
  border-radius: 20px;
  padding: 20px;
  box-shadow: 0 8px 20px rgba(0,0,0,0.08);
}
.date {
  text-align: center;
  font-weight: bold;
  font-size: 18px;
  margin-bottom: 20px;
}
.readings {
  display: flex;
  justify-content: space-between;
  margin-bottom: 12px;
}
.circle {
  width: 64px;
  height: 64px;
  border-radius: 50%;
  border: 1px solid #ddd;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  font-size: 16px;
}
.title {
  text-align: center;
  font-size: 16px;
  margin-bottom: 10px;
}
.subtitle {
  text-align: center;
  font-size: 14px;
  color: #666;
  margin-bottom: 14px;
}
.prayer {
  text-align: center;
  color: #666;
  margin-bottom: 16px;
}
.progress-box {
  margin-bottom: 16px;
}
.progress {
  width: 100%;
  height: 10px;
  background: #eee;
  border-radius: 6px;
  overflow: hidden;
}
.progress-bar {
  height: 100%;
  background: #7b61ff;
  width: 0%;
}
.progress-text {
  text-align: center;
  font-size: 14px;
  margin-top: 6px;
}
button {
  width: 100%;
  padding: 14px;
  background: #7b61ff;
  color: #fff;
  border: none;
  border-radius: 14px;
  font-size: 16px;
}
.calendar {
  margin-top: 20px;
}
.calendar table {
  width: 100%;
  border-collapse: collapse;
  text-align: center;
  font-size: 14px;
}
.calendar th, .calendar td {
  padding: 6px;
}
.today {
  background: #7b61ff;
  color: #fff;
  border-radius: 50%;
}
</style>
</head>

<body>
<div class="app">
  <div class="card">

    <div class="date" id="date"></div>

    <div class="readings">
      <div class="circle">창</div>
      <div class="circle">마</div>
      <div class="circle">시</div>
      <div class="circle">행</div>
    </div>

    <div class="title" id="readingToday"></div>
    <div class="subtitle" id="readingTomorrow"></div>

    <div class="prayer">
      말씀을 두 배로 먹는 은혜를 주소서.
    </div>

    <div class="progress-box">
      <div class="progress">
        <div class="progress-bar" id="bar"></div>
      </div>
      <div class="progress-text" id="progressText"></div>
    </div>

    <button onclick="complete()">오늘(2일 분량) 읽기 완료</button>

    <div class="calendar" id="calendar"></div>

  </div>
</div>

<script>
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("service-worker.js");
}

const today = new Date();
const year = today.getFullYear();
const start = new Date(year, 0, 1);
const dayOfYear = Math.floor((today - start) / 86400000) + 1;

document.getElementById("date").innerText =
  `${year}.${today.getMonth()+1}.${today.getDate()}  오늘`;

document.getElementById("readingToday").innerText =
  `오늘: 맥체인 ${dayOfYear}일`;
document.getElementById("readingTomorrow").innerText =
  `함께 읽기: ${dayOfYear + 1}일`;

const key = "mcheyne-2read";
let done = JSON.parse(localStorage.getItem(key)) || [];

function complete() {
  const d = today.toISOString().slice(0,10);
  if (!done.includes(d)) {
    done.push(d);
    localStorage.setItem(key, JSON.stringify(done));
  }
  update();
}

function update() {
  const completedDays = done.length * 2;
  const percent = (completedDays / 730 * 100).toFixed(1);
  document.getElementById("bar").style.width = percent + "%";
  document.getElementById("progressText").innerText =
    `2독 진행률 ${percent}% (${completedDays}/730일)`;
}
update();

function drawCalendar() {
  const first = new Date(year, today.getMonth(), 1).getDay();
  const last = new Date(year, today.getMonth()+1, 0).getDate();
  let html = "<table><tr>";
  ["일","월","화","수","목","금","토"].forEach(d => html += `<th>${d}</th>`);
  html += "</tr><tr>";
  for(let i=0;i<first;i++) html += "<td></td>";
  for(let d=1; d<=last; d++) {
    const cls = d === today.getDate() ? "today" : "";
    html += `<td class="${cls}">${d}</td>`;
    if((d+first)%7===0) html+="</tr><tr>";
  }
  html += "</tr></table>";
  document.getElementById("calendar").innerHTML = html;
}
drawCalendar();
</script>
</body>
</html>
